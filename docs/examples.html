<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EtherCAT Control Framework: EtherCAT Control Software</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="symbol.webp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EtherCAT Control Framework
   &#160;<span id="projectnumber">v0.9</span>
   </div>
   <div id="projectbrief">Implementation of EtherCAT protocol using IgH EtherCAT library for robot controller.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EtherCAT Control Software Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock">
<p>
  <!-- Welcome to EtherCAT user space application by Veysi ADIN &amp; Chunwoo Kim.This repository contains EtherCAT based control software using CoE and CiA402 standard to control motors and receive sensor data, by wrapping IgH EtherCAT library functions. This implementation can be used with any robotic systems supporting EtherCAT protocol with small modifications. It contains EtherCAT real-time thread with priority of 98. And USB communication with Xbox <a class="el" href="structController.html" title="Xbox Controller values.">Controller</a>. You can use different type of user input device as well with small modifications. -->
Considering that you are done with the prerequisites and installation. You are ready to experiment with the software and see its capabilities using example controls below. Examples contains:
<div class="fragment"> Velocity Mode Control - using Xbox controller, or keyboard,
  <a href="examples.html#autotoc_md1">Go to example</a>
</div>
<div class="fragment"> Position Mode Control - using Xbox controller, or keyboard,
 <a href="examples.html#autotoc_md2">Go to example</a>
</div>
<div class="fragment"> Torque Mode Control - using Xbox controller, or keyboard,
  <a href="examples.html#autotoc_md3">Go to example</a>
</div> 
<div class="fragment"> Cyclic Synchronous Velocity Mode Control - using Xbox controller, or keyboard,
  <a href="examples.html#autotoc_md4">Go to example</a>
</div> 
<div class="fragment"> Cyclic Synchronous Position Mode Control - using Xbox controller, or keyboard,
  <a href="examples.html#autotoc_md5">Go to example</a>
</div> 
<div class="fragment"> Cyclic Synchronous Torque Mode Control - using Xbox controller, or keyboard,
  <a href="examples.html#autotoc_md6">Go to example</a>
</div> 
<div class="fragment"> Mapping Custom PDOs, other than default PDO,
  <a href="examples.html#autotoc_md7">Go to example</a>
</div> 
<div class="fragment"> Adding extra configuration parameters other than default configuration,
  <a href="examples.html#autotoc_md8">Go to example</a>
</div> 
<div class="fragment"> Adding custom slave - EasyCAT custom slave example.
  <a href="examples.html#autotoc_md9">Go to example</a>
</div> 
Improving real-time performance : 
<div class="fragment"> Isolating CPU for the communication task.
  <a href="examples.html#autotoc_md10">Go to example</a>
</div> 


</p>
<p> All prepared examples here are just for reference, in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the  GNU General Public License for more details.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Velocity Mode Control Example</h1>
<p>
  Now in this example we have three servo drives as slaves, and three motors, we are going to control them in velocity mode with 1kHz frequency and active distributed clock. As a controller we will use Xbox controller or keyboard.  
<ul>
  <li>Servo drivers: Maxon EPOS4 Compact 50/5 EtherCAT - 3pcs. </li>
  <li>Motors : Maxon DC motor with 512CPR encoder, and 49:1 Gear ratio. - 3pcs. </li>
</ul>
</p>
<p>
  We will start our modifications from the <a href="ecat__globals_8hpp_source.html">
  ecat_globals.hpp</a> file. In this file we have to change several parameters: 
  <li><a href="ecat__globals_8hpp.html#a5d918ecbea3b854bbfe74765c9357be3">NUM_OF_SLAVES</a> 3</li>
  <li><a href="ecat__globals_8hpp.html#aacc3c7aef173b1cde9377fb7f05c924d">g_kNumberOfServoDrivers</a>=3</li>
  <li><a href="ecat__globals_8hpp.html#a84142cd3e3bf14c4ecd4b6707a808c39">FREQUENCY</a> 1000</li>
  <li><a href="ecat__globals_8hpp.html#abc038b9c4db3369a55eec862a3fac0d3">VELOCITY_MODE</a> 1 </li>
  <li><a href="ecat__globals_8hpp.html#a1d48656bc4df51f3d8b17da91494a981">DISTRIBUTED_CLOCK</a> 1 </li>
  <li><a href="ecat__globals_8hpp.html#a1b5f0a2cda8866a2a87331026ac8bd9a">GEAR_RATIO</a> 49</li>
  <li><a href="ecat__globals_8hpp.html#a8cdc17f43c9f3850f60d04f98216fc13">ENCODER_RESOLUTION</a> 512</li>
</p> 
<p>
  Once we're done with initial costumization we can proceed with <a href="https://github.com/veysiadn/ecat_userspace/blob/master/src/main.cpp">main.cpp</a> file.
   In this file we have to specify how to handle controller inputs. By default controller is assumed to be Xbox controller. If you want to use Xbox, it is nice to understand how Xbox controller data is structred. For that, I recommend using jstest-gtk package.
   <div class="fragment"> sudo apt-get install jstest-gtk</div>
   <p>Run jstest-gtk and choose your connected controller by</p>
   <div class="fragment"> jstest-gtk</div>
   <p>It will have an interface like in picture below. As shown in picture below, range for Xbox controller axes are -/+ 32767 and we have 10 digital buttons. We can use axis data to control our motor in velocity mode.</p>
    <img src="img/jstest-gtk.png" alt="jstest-gtk"/></a>
    <p>As you can see the code below in <a href="https://github.com/veysiadn/ecat_userspace/blob/master/src/main.cpp">main.cpp</a> file is reading xbox controller values and passes it to ethercat thread. In this case we normalized axes values by diving the data that we get to 32767, therefore range is now -/+1.</p>
    <img src="img/XboxControllerDataReadCode.png" alt="controllervals"/></a>
    <p>If you don't have Xbox or any other controller don't worry, you can still use your keyboard to send commands, it won't be as convenient as using controller, but it will do the job for test purposes.
      Note that this is the default setup, you can tinker with parameters to make it suitable to your application.
    </p>
    <img src="img/KeyboardDataRead.png" alt="controllervals"/></a>
    <p>Now that we costumized parameters for the controller, now we can costumize the application. For that we will have to modify <a href="https://github.com/veysiadn/ecat_userspace/blob/master/src/ecat_lifecycle.cpp">ecat_lifecycle.cpp</a> file.
    </p>
  <li><a href="ecat__globals_8hpp.html#a5d918ecbea3b854bbfe74765c9357be3">NUM_OF_SLAVES</a> 3</li>
  <li><a href="ecat__globals_8hpp.html#aacc3c7aef173b1cde9377fb7f05c924d">g_kNumberOfServoDrivers</a>=3</li>
  <li><a href="ecat__globals_8hpp.html#a84142cd3e3bf14c4ecd4b6707a808c39">FREQUENCY</a> 1000</li>
  <li><a href="ecat__globals_8hpp.html#abc038b9c4db3369a55eec862a3fac0d3">VELOCITY_MODE</a> 1 </li>
  <li><a href="ecat__globals_8hpp.html#a1b5f0a2cda8866a2a87331026ac8bd9a">GEAR_RATIO</a> 49</li>
  <li><a href="ecat__globals_8hpp.html#a8cdc17f43c9f3850f60d04f98216fc13">ENCODER_RESOLUTION</a> 512</li>
</p> 
   
<ul>
<li><a href="https://github.com/veysiadn/IgHEtherCATImplementation">IgH EtherCAT Implementation</a></li>
<li><a href="https://github.com/veysiadn/RT_PREEMPT_INSTALL">RT_PREEMPT Patched Linux</a></li>
<li>If you want to use <a href="https://github.com/veysiadn/xenomai-install">Xenomai-Installation</a></li>
</ul>
<p>Once you install the prerequisites you're ready to build the control software.</p>

<h1><a class="anchor" id="autotoc_md2"></a>
Position Mode Control Example</h1>
<p>
  Now in this example we will have ......
</p>
<div class="fragment"><div class="line">------- </div>
<div class="line">------</div>
<div class="line">-------</div>
<div class="line">------</div>
<div class="line">----------</div>
<div class="line">--------</div>
</div>
</div><!-- fragment --><p>If there is no error during the compilation process you are ready to run the executable. </p><div class="fragment"><div class="line">---------------</div>
</div><!-- fragment --><p>If it is running your implementation is succesful, and now you are ready to customize the software based on your application. By default number of connected slaves are defined as one, therefore if you don't have any slave to connect to your Ethernet port software will raise an error about the situation, but don't worry you can customize the software based on your needs.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Torque Mode Control Example</h1>
<p>
  Now in this example we will have ......
</p>
<div class="fragment"><div class="line">------- </div>
<div class="line">------</div>
<div class="line">-------</div>
<div class="line">------</div>
<div class="line">----------</div>
<div class="line">--------</div>
</div>
<h1><a class="anchor" id="autotoc_md4"></a>
Cyclic Synchrnous Velocity Mode Control Example</h1>
<p>
  Now in this example we will have ......
</p>
<div class="fragment"><div class="line">------- </div>
<div class="line">------</div>
<div class="line">-------</div>
<div class="line">------</div>
<div class="line">----------</div>
<div class="line">--------</div>
</div>
<h1><a class="anchor" id="autotoc_md5"></a>
  Cyclic Synchrnous Position Mode Control Example</h1>
  <p>
    Now in this example we will have ......
  </p>
  <div class="fragment"><div class="line">------- </div>
  <div class="line">------</div>
  <div class="line">-------</div>
  <div class="line">------</div>
  <div class="line">----------</div>
  <div class="line">--------</div>
  </div>
<h1><a class="anchor" id="autotoc_md6"></a>
  Cyclic Synchrnous Torque Mode Control Example</h1>
<ul>
<li>Change configuration parameters for your motor in <a class="el" href="ecat__node_8cpp.html">ecat_node.cpp</a> file based on your operation mode. For example if you want to use velocity mode you can change parameters in the SetProfileVelocityParametersAll(ProfileVelocityParam&amp; P) function based on your needs.</li>
<li>Change control parameters based on your selected operation mode in <a class="el" href="ecat__lifecycle_8cpp.html">ecat_lifecycle.cpp</a> file in the Update functions. For example if you want to use velocity mode in your control loop, you can change function content of UpdateVelocityModeParameters();</li>
</ul>
<p>Once you did those changes you will need recompile the software using make and you can test the executable.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Mapping Custom PDO Example</h1>
<ul>
<li>This software heavily tested on Maxon EPOS drivers, therefore if you want to use different servo driver you will need to check PDO mapping of your slave, or you can do custom PDO mapping by using MapCustomPdo function defined in <a class="el" href="ecat__node_8cpp.html">ecat_node.cpp</a> file. </li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Custom SDO configuration Example</h1>
<p>
  Now in this example we will have ......
</p>
<div class="fragment"><div class="line">------- </div>
<div class="line">------</div>
<div class="line">-------</div>
<div class="line">------</div>
<div class="line">----------</div>
<div class="line">--------</div>
</div>
<h1><a class="anchor" id="autotoc_md9"></a>
Custom Slave Example</h1>
<p>
  Now in this example we will have ......
</p>
<div class="fragment"><div class="line">------- </div>
<div class="line">------</div>
<div class="line">-------</div>
<div class="line">------</div>
<div class="line">----------</div>
<div class="line">--------</div>
</div>

<h1><a class="anchor" id="autotoc_md9"></a>
  Isolating CPU for the communication task</h1>
  <p>
    Now in this example we will have ......
  </p>
  <div class="fragment"><div class="line">------- </div>
  <div class="line">------</div>
  <div class="line">-------</div>
  <div class="line">------</div>
  <div class="line">----------</div>
  <div class="line">--------</div>
  </div>


<h1><a class="anchor" id="autotoc_md11"></a>
  References</h1>
  <ul>
    <li><a href="https://www.ethercat.org/en/technology.html">EtherCAT</a></li>
    <li><a href="https://www.etherlab.org/en/ethercat/index.php">Etherlab Webpage</a></li>
    <li><a href="https://www.etherlab.org/download/ethercat/ethercat-1.5.2.pdf">IgH EtherCAT Library Documentation</a></li>
    <li><a href="https://wiki.linuxfoundation.org/realtime/documentation/technical_basics/start">Real-time Linux</a></li>
    <li><a href="https://design.ros2.org/articles/realtime_background.html">Real-time Background</a></li>
    <li><a href="https://www.ripublication.com/ijaer17/ijaerv12n21_94.pdf">Article on EtherCAT-RT PREEMPT- Xenomai</a></li>
    </ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
